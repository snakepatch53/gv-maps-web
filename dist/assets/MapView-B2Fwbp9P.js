import{r as l,u as O,M as w,z as M,t as d,j as e,h as F,A as C,B as L,i as A,C as E,c as x,F as y,D as H,b as T,H as V,o as D,E as _}from"./index-C-cPZgJk.js";import{u as $,b as R,P,c as z,M as K,a as B}from"./MapLayerControl-e2RZNwoG.js";import{F as G,c as U,a as Y,d as j,E as N,b as J}from"./index.esm-DplBP5vu.js";function Q(){return $().map}function q(n){const t=Q();return l.useEffect(function(){return t.on(n),function(){t.off(n)}},[t,n]),t}function W(){const{map_id:n}=O(),{toolSelected:t}=l.useContext(w),{markers:a,addMarker:s,moveMarker:c,removeMarker:u,openMarkerForm:i}=l.useContext(M);if(q({click(r){t.type===C.MARKER&&s({latitude:r.latlng.lat,longitude:r.latlng.lng,type:t.name,map_id:n})}}),!(!a||a===null))return a.map(r=>{const o=Object.values(d).find(m=>m.name===r.type);return e.jsx(R,{position:{lat:r.latitude,lng:r.longitude},draggable:t.name===d.MOVE.name,icon:F({width:45,height:45,icon:o.icon}),eventHandlers:{click:()=>{t.name===d.TRASH.name&&u(r.id)},dblclick:()=>{i(r)},dragend:m=>{t.name===d.MOVE.name&&c(m,r.id)}},children:e.jsx(P,{children:r.name_auto})},r.id)})}function X(){const{map_id:n}=O(),{fibers:t,handleClick:a,handleLineClick:s,handleDrag:c,onToolChange:u,removeFiberMarker:i}=l.useContext(L),{toolSelected:r}=l.useContext(w);if(l.useEffect(()=>{u()},[r]),q({click:o=>a(o,n,r)}),!(!t||t===null))return t==null?void 0:t.map(o=>{var h;const m=(h=o==null?void 0:o.fiber_markers)==null?void 0:h.map(p=>({lat:p.latitude,lng:p.longitude})),f=Object.values(d).find(p=>p.name===o.type);return e.jsxs("div",{children:[e.jsx(z,{pathOptions:{color:f.color},positions:m,weight:f.weight,eventHandlers:{click:p=>{r.name===d.MOVE.name&&s(p,o.id)}},children:r.name===d.POINTER.name&&e.jsx(P,{children:A(m)})}),(r.name===d.MOVE.name||r.name===d.TRASH.name)&&o.fiber_markers.map(p=>e.jsx(R,{position:{lat:p.latitude,lng:p.longitude},icon:F({width:20,height:20,icon:"/point.png"}),draggable:r.name===d.MOVE.name,eventHandlers:{click:()=>{r.name===d.TRASH.name&&i(p)},dragend:I=>{r.name===d.MOVE.name&&c(I,p)}}},p.id))]},o.id)})}function k({value:n,onChange:t}){const[a,s]=l.useState(n),c=(u,i)=>{s(u),t&&t(u,i)};return l.useEffect(()=>{s(n)},[n]),e.jsx("div",{className:" grid grid-cols-6 gap-1 ",children:Object.values(E).map((u,i)=>{const r=Object.keys(E)[i],o=a===u||a==r;return e.jsx("div",{className:x(" flex w-8 aspect-square rounded-full border  border-transparent transition hover:scale-110 ",{" border-black ":o}),children:e.jsx("button",{onClick:()=>c(u,r),type:"button",className:x(" w-full h-full rounded-full shadow-lg border-2 border-transparent transition ",{" border-green-400 ":o}),style:{backgroundColor:u}})},i)})})}function Z({value:n,onChange:t}){const[a,s]=l.useState(n),c=u=>()=>{s(u),t&&t(u)};return l.useEffect(()=>{s(n)},[n]),e.jsxs("div",{className:" flex gap-2 ",children:[e.jsx(v,{label:2,selected:a,onClick:c(2)}),e.jsx(v,{label:4,selected:a,onClick:c(4)}),e.jsx(v,{label:8,selected:a,onClick:c(8)}),e.jsx(v,{label:16,selected:a,onClick:c(16)})]})}function v({label:n,selected:t,...a}){const s=t==n;return e.jsx("button",{type:"button",className:x(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 ":s}),...a,children:e.jsx("span",{className:" font-normal ",children:n})})}function S({selected:n,onSelect:t}){const a=Object.values(d).filter(s=>s.type===C.MARKER);return n||(n=a[0]),e.jsx(e.Fragment,{children:a.map(s=>e.jsx("button",{type:"button",className:x(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg ",{" bg-black/10":s.name===n.name}),onClick:()=>t(s),children:e.jsx("img",{className:"w-full h-full object-contain",src:s.icon,alt:s.name})},s.name))})}function ee(){const n=l.useRef(null),{isMarkerFormOpen:t,closeMarkerForm:a}=l.useContext(M);return l.useEffect(()=>{const s=c=>c.key==="Escape"&&a();return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),n.current&&(n.current.onclick=s=>{s.target===n.current&&a()}),e.jsx("div",{className:x(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!t}),ref:n,children:e.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[e.jsx("div",{className:" flex justify-end ",children:e.jsx("button",{onClick:a,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:e.jsx(y,{icon:H})})}),e.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar"}),e.jsx(ne,{})]})})}function ne(){const{markerSelected:n,updateMarker:t}=l.useContext(M),a=Object.values(d).filter(i=>i.type===C.MARKER),[s,c]=l.useState(null);l.useEffect(()=>{const i=a.find(r=>r.name===(n==null?void 0:n.type));c(i)},[n]);const u=i=>c(i);return n?e.jsx(G,{initialValues:{name:(n==null?void 0:n.name)||"",latitude:(n==null?void 0:n.latitude)||"",longitude:(n==null?void 0:n.longitude)||"",description:(n==null?void 0:n.description)||"",type:(n==null?void 0:n.type)||"",reserve_meters:(n==null?void 0:n.reserve_meters)||1,nap_buffer:(n==null?void 0:n.nap_buffer)||1,nap_thread:(n==null?void 0:n.nap_thread)||1,nap_ports:(n==null?void 0:n.nap_ports)||1},validationSchema:U({name:Y().required("Ingrese el nombre del marcador"),latitude:j().required("Ingrese la latitud"),longitude:j().required("Ingrese la longitud"),reserve_meters:j().required("Ingrese los metros de reserva"),nap_buffer:j().required("Ingrese el buffer"),nap_thread:j().required("Ingrese el puerto"),nap_ports:j().required("Ingrese el numero de puertos")}),onSubmit:async i=>{await t(n.id,i)},children:({handleSubmit:i,values:r,handleChange:o,isSubmitting:m})=>e.jsxs("form",{onSubmit:i,className:" flex flex-col ",children:[e.jsx(b,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),e.jsx("input",{type:"text"}),e.jsxs("div",{className:" flex gap-3 ",children:[e.jsx(b,{name:"latitude",label:"Latitud:",placeholder:"Latitud"}),e.jsx(b,{name:"longitude",label:"Longitud:",placeholder:"Longitud"})]}),e.jsx(b,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),e.jsxs("div",{children:[e.jsxs("label",{className:" flex items-center gap-1 ",children:[e.jsx(g,{text:"Tipo de Marcador:"}),e.jsx("span",{className:" font-normal uppercase text-sm pb-1 ",children:s==null?void 0:s.name})]}),e.jsx("div",{className:" flex justify-evenly ",children:e.jsx(S,{selected:s,onSelect:f=>{u(f),o({target:{name:"type",value:f.name}})}})})]}),(s==null?void 0:s.name)===d.RESERVA.name&&e.jsx(b,{name:"reserve_meters",type:"number",label:"METROS:",placeholder:"Metros de reserva"}),((s==null?void 0:s.name)===d.NAP1.name||(s==null?void 0:s.name)===d.NAP2.name)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" flex gap-4 ",children:[e.jsxs("div",{className:" flex flex-col gap-2 ",children:[e.jsx(g,{text:"Buffer:"}),e.jsx(k,{onChange:(f,h)=>o({target:{name:"nap_buffer",value:h}}),value:r.nap_buffer}),e.jsx(N,{name:"nap_buffer"})]}),e.jsxs("div",{className:" flex flex-col gap-2 ",children:[e.jsx(g,{text:"Hilo:"}),e.jsx(k,{onChange:(f,h)=>o({target:{name:"nap_thread",value:h}}),value:r.nap_thread}),e.jsx(N,{name:"nap_thread"})]})]}),e.jsxs("div",{children:[e.jsx(g,{text:"Numero de Puertos:"}),e.jsx(Z,{value:r.nap_ports})]})]}),e.jsx("button",{type:"submit",className:x(" bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":m}),disabled:m,children:m?e.jsx(y,{icon:T,spin:!0}):"Guardar"})]})}):null}function b({label:n,classInput:t="",...a}){return e.jsxs("div",{className:" flex-1 flex flex-col ",children:[e.jsx(g,{text:n}),e.jsx(J,{name:a.name,className:x(" border rounded p-2 ",t),...a}),e.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:e.jsx(N,{name:a.name})})]})}function g({text:n,className:t}){return e.jsx("label",{className:x(" font-bold text-sm uppercase pl-1 mb-1 ",t),children:n})}function ie(){const{isOpenHeaderOptions:n}=l.useContext(V),{isMarkerFormOpen:t}=l.useContext(M);return e.jsxs("div",{className:" relative flex w-full h-full ",children:[e.jsx(ee,{}),e.jsx("div",{className:x(" relative flex w-full h-full p-7",{" -z-10 ":n||t}),children:e.jsxs("div",{className:" flex flex-col w-full h-full rounded-2xl shadow-xl overflow-hidden bg-white ",children:[e.jsxs("div",{className:" flex items-center py-1 px-4 ",children:[Object.values(d).map(a=>e.jsx(ae,{tool:a},a.name)),e.jsxs("div",{className:" flex items-center border w-full max-w-96 py-2 px-2 ml-auto rounded ",children:[e.jsx("input",{className:" w-full ",type:"text",placeholder:"Buscar lugar"}),e.jsx(y,{icon:D})]})]}),e.jsx(se,{})]})})]})}const te=async n=>await(await fetch(`https://nominatim.openstreetmap.org/search?q=${n}&format=json`)).json(),se=()=>{const{toolSelected:n}=l.useContext(w),t=l.useRef(null);return l.useEffect(()=>{if(t.current){const a=t.current;(async c=>{const u=await te(c);if(u.length>0){const{lat:i,lon:r}=u[0],o=_.latLng(i,r);_.marker(o).addTo(a).bindPopup("UbicaciÃ³n encontrada").openPopup(),a.setView(o,13)}})("New York")}},[]),l.useEffect(()=>{t.current&&(document.querySelector(".leaflet-container").style.cursor=n.cursor)},[n]),e.jsxs(K,{ref:t,className:x(" flex w-full h-full cursor-pointer "),center:{lat:-2.3093213892775175,lng:-78.12541130262117},zoom:16,style:{height:"100%",width:"100%"},children:[e.jsx(B,{}),e.jsx(W,{}),e.jsx(X,{})]})};function ae({tool:n}){const{toolSelected:t,selectTool:a}=l.useContext(w),s=t.name===n.name,c=typeof n.icon=="string";return e.jsxs("button",{onClick:()=>a(n),className:x(" flex flex-col justify-between items-center py-1 px-3 h-full rounded transition-all hover:bg-black/5 hover:scale-110 ",{" opacity-80  ":!s," bg-black/5 hover:scale-100 ":s}),style:{color:n.color},children:[c?e.jsx("img",{className:" h-full max-h-6 aspect-square object-contain",src:n.icon,alt:n.name}):e.jsx(y,{className:"text-lg",icon:n.icon}),e.jsx("p",{className:" text-black text-[10.5px] ",children:n.name})]})}export{ie as default};
