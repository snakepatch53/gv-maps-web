import{u as T,r as o,M as h,z as k,t as d,j as n,h as q,A as g,B as b,i as A,C as D,c as p,F as j,D as V,b as E,H as G,o as J}from"./index-CAIGUo8h.js";import{u as _,b as L,P,c as $,M as Q,a as U}from"./MapLayerControl-C8QZJdBp.js";import{F as B,c as z,a as I,d as y,E as F,b as K}from"./index.esm-DoKgJw6L.js";function W(){const{map_id:e}=T(),{toolSelected:s}=o.useContext(h),{markers:a,addMarker:t,moveMarker:r,removeMarker:l,openMarkerForm:c}=o.useContext(k);if(_({click(i){s.type===g.MARKER&&t({latitude:i.latlng.lat,longitude:i.latlng.lng,type:s.name,map_id:e})}}),!(!a||a===null))return a.map(i=>{const u=Object.values(d).find(x=>x.name===i.type);return n.jsx(L,{position:{lat:i.latitude,lng:i.longitude},draggable:s.name===d.MOVE.name,icon:q({width:45,height:45,icon:u.icon}),eventHandlers:{click:()=>{s.name===d.TRASH.name&&l(i.id)},dblclick:()=>{c(i)},dragend:x=>{s.name===d.MOVE.name&&r(x,i.id)}},children:n.jsx(P,{children:i.name_auto})},i.id)})}function X(){const{map_id:e}=T(),{fibers:s,handleClick:a,handleLineClick:t,onToolChange:r,openFiberForm:l}=o.useContext(b),{toolSelected:c}=o.useContext(h);if(o.useEffect(()=>{r()},[c]),_({click:i=>a(i,e,c),keydown:i=>{var x;const u=(x=i==null?void 0:i.originalEvent)==null?void 0:x.key;(u==="Escape"||u==="Enter")&&r()}}),!(!s||s===null))return s==null?void 0:s.map(i=>{var f;const u=(f=i==null?void 0:i.fiber_markers)==null?void 0:f.map(m=>[m.latitude,m.longitude]),x=Object.values(d).find(m=>m.name===i.type);return n.jsxs("div",{children:[n.jsx($,{pathOptions:{color:x.color},positions:u,weight:x.weight,eventHandlers:{click:m=>{c.name===d.MOVE.name&&t(m,i.id)},dblclick:()=>{c.name===d.POINTER.name&&l(i)}},children:c.name===d.POINTER.name&&n.jsx(P,{children:A(u)})}),console.log("recreando"),n.jsx(Y,{fiber:i,positions:u}),n.jsx(Z,{fiber:i})]},i.id)})}function Y({fiber:e,positions:s}){const{handleDrag:a,removeFiberMarker:t}=o.useContext(b),{toolSelected:r}=o.useContext(h);return r.name!==d.MOVE.name&&r.name!==d.TRASH.name?null:e.fiber_markers.map((l,c)=>n.jsx(L,{position:{lat:l.latitude,lng:l.longitude},icon:q({width:20,height:20,icon:"/point.png"}),draggable:r.name===d.MOVE.name,eventHandlers:{click:()=>{r.name===d.TRASH.name&&t(l)},dragend:i=>{console.log("hola"),r.name===d.MOVE.name&&a(i,l)}},children:n.jsx(P,{children:A(s.slice(0,c+1))})},l.id))}function Z({fiber:e}){const{fiberSelected:s}=o.useContext(b),{toolSelected:a}=o.useContext(h);return a.type!==g.FIBER||(s==null?void 0:s.id)!==e.id?null:e.fiber_markers.map(t=>n.jsx(L,{position:{lat:t.latitude,lng:t.longitude},icon:q({width:30,height:95,icon:"/marker.png"})},t.id))}function H({value:e,onChange:s}){const[a,t]=o.useState(e),r=(l,c)=>{t(l),s&&s(l,c)};return o.useEffect(()=>{t(e)},[e]),n.jsx("div",{className:" grid grid-cols-6 gap-1 ",children:Object.values(D).map((l,c)=>{const i=Object.keys(D)[c],u=a===l||a==i;return n.jsx("div",{className:p(" flex w-8 aspect-square rounded-full border  border-transparent transition hover:scale-110 ",{" border-black ":u}),children:n.jsx("button",{onClick:()=>r(l,i),type:"button",className:p(" w-full h-full rounded-full shadow-lg border-2 border-transparent transition ",{" border-green-400 ":u}),style:{backgroundColor:l}})},c)})})}function ee({selected:e,onSelect:s}){const a=Object.values(d).filter(t=>t.type===g.MARKER);return e||(e=a[0]),n.jsx(n.Fragment,{children:a.map(t=>n.jsx("button",{type:"button",className:p(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg ",{" bg-black/10":t.name===e.name}),onClick:()=>s(t),children:n.jsx("img",{className:"w-full h-full object-contain",src:t.icon,alt:t.name})},t.name))})}function ne({value:e,onChange:s}){const[a,t]=o.useState(e),r=l=>()=>{t(l),s&&s(l)};return o.useEffect(()=>{t(e)},[e]),n.jsxs("div",{className:" flex gap-2 ",children:[n.jsx(C,{label:2,selected:a,onClick:r(2)}),n.jsx(C,{label:4,selected:a,onClick:r(4)}),n.jsx(C,{label:8,selected:a,onClick:r(8)}),n.jsx(C,{label:16,selected:a,onClick:r(16)})]})}function C({label:e,selected:s,...a}){const t=s==e;return n.jsx("button",{type:"button",className:p(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 ":t}),...a,children:n.jsx("span",{className:" font-normal ",children:e})})}function te(){const e=o.useRef(null),{isMarkerFormOpen:s,closeMarkerForm:a}=o.useContext(k);return o.useEffect(()=>{const t=r=>r.key==="Escape"&&a();return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),e.current&&(e.current.onclick=t=>{t.target===e.current&&a()}),n.jsx("div",{className:p(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!s}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:a,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(j,{icon:V})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar"}),n.jsx(se,{})]})})}function se(){const{markerSelected:e,updateMarker:s}=o.useContext(k),a=Object.values(d).filter(c=>c.type===g.MARKER),[t,r]=o.useState(null);o.useEffect(()=>{const c=a.find(i=>i.name===(e==null?void 0:e.type));r(c)},[e]);const l=c=>r(c);return e?n.jsx(B,{initialValues:{name:(e==null?void 0:e.name)||"",latitude:(e==null?void 0:e.latitude)||"",longitude:(e==null?void 0:e.longitude)||"",description:(e==null?void 0:e.description)||"",type:(e==null?void 0:e.type)||"",reserve_meters:(e==null?void 0:e.reserve_meters)||1,nap_buffer:(e==null?void 0:e.nap_buffer)||1,nap_thread:(e==null?void 0:e.nap_thread)||1,nap_ports:(e==null?void 0:e.nap_ports)||1},validationSchema:z({name:I().required("Ingrese el nombre del marcador"),latitude:y().required("Ingrese la latitud"),longitude:y().required("Ingrese la longitud"),reserve_meters:y().required("Ingrese los metros de reserva"),nap_buffer:y().required("Ingrese el buffer"),nap_thread:y().required("Ingrese el puerto"),nap_ports:y().required("Ingrese el numero de puertos")}),onSubmit:async c=>{await s(e.id,c)},children:({handleSubmit:c,values:i,handleChange:u,isSubmitting:x})=>n.jsxs("form",{onSubmit:c,className:" flex flex-col ",children:[n.jsx(N,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsxs("div",{className:" flex gap-3 ",children:[n.jsx(N,{name:"latitude",label:"Latitud:",placeholder:"Latitud"}),n.jsx(N,{name:"longitude",label:"Longitud:",placeholder:"Longitud"})]}),n.jsx(N,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{children:[n.jsxs("label",{className:" flex items-center gap-1 ",children:[n.jsx(w,{text:"Tipo de Marcador:"}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 ",children:t==null?void 0:t.name})]}),n.jsx("div",{className:" flex justify-evenly ",children:n.jsx(ee,{selected:t,onSelect:f=>{l(f),u({target:{name:"type",value:f.name}})}})})]}),(t==null?void 0:t.name)===d.RESERVA.name&&n.jsx(N,{name:"reserve_meters",type:"number",label:"METROS:",placeholder:"Metros de reserva"}),((t==null?void 0:t.name)===d.NAP1.name||(t==null?void 0:t.name)===d.NAP2.name)&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:" flex gap-4 ",children:[n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(w,{text:"Buffer:"}),n.jsx(H,{onChange:(f,m)=>u({target:{name:"nap_buffer",value:m}}),value:i.nap_buffer}),n.jsx(F,{name:"nap_buffer"})]}),n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(w,{text:"Hilo:"}),n.jsx(H,{onChange:(f,m)=>u({target:{name:"nap_thread",value:m}}),value:i.nap_thread}),n.jsx(F,{name:"nap_thread"})]})]}),n.jsxs("div",{children:[n.jsx(w,{text:"Numero de Puertos:"}),n.jsx(ne,{value:i.nap_ports})]})]}),n.jsx("button",{type:"submit",className:p(" bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":x}),disabled:x,children:x?n.jsx(j,{icon:E,spin:!0}):"Guardar"})]})}):null}function N({label:e,classInput:s="",...a}){return n.jsxs("div",{className:" flex-1 flex flex-col ",children:[n.jsx(w,{text:e}),n.jsx(K,{name:a.name,className:p(" border rounded p-2 ",s),...a}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(F,{name:a.name})})]})}function w({text:e,className:s}){return n.jsx("label",{className:p(" font-bold text-sm uppercase pl-1 mb-1 ",s),children:e})}function ae({selected:e,onSelect:s}){const a=Object.values(d).filter(t=>t.type===g.FIBER);return e||(e=a[0]),n.jsx(n.Fragment,{children:a.map(t=>n.jsxs("button",{type:"button",className:p(" flex flex-col justify-center items-center w-[52px] aspect-square bg-transparent transition-all duration-300 py-1 px-1.5 rounded-lg hover:bg-black/5 ",{" bg-black/10 hover:bg-black/10 ":t.name===e.name}),onClick:()=>s(t),children:[n.jsx(j,{style:{color:t.color},className:"text-lg",icon:t.icon}),n.jsx("span",{className:" text-xs leading-3 ",children:t.name})]},t.name))})}function re({fiberType:e,value:s,onChange:a}){const[t,r]=o.useState(null),l=c=>{a&&a(c)};return o.useEffect(()=>{e&&(e===d.DROP.name&&r([1,2,4,6,8,12]),e===d.MINI_ADSS.name&&r([6,8,12,24,48]),e===d.ADSS.name&&r([12,24,48,72,96]))},[e]),o.useEffect(()=>{t&&(t.includes(s)||l(t[0]))},[t]),e?n.jsx("div",{className:" flex justify-center gap-1 ",children:t==null?void 0:t.map(c=>n.jsx(le,{label:c,selected:s,onClick:()=>l(c)},c))}):null}function le({label:e,selected:s,...a}){const t=s==e;return n.jsx("button",{type:"button",className:p(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 hover:bg-black/10 ":t}),...a,children:n.jsx("span",{className:" font-normal ",children:e})})}function ie(){const e=o.useRef(null),{isFiberFormOpen:s,closeFiberForm:a}=o.useContext(b);return o.useEffect(()=>{const t=r=>r.key==="Escape"&&a();return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),e.current&&(e.current.onclick=t=>{t.target===e.current&&a()}),n.jsx("div",{className:p(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!s}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:a,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(j,{icon:V})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar Fibra"}),n.jsx(oe,{})]})})}function oe(){const{fiberSelected:e,updateFiber:s,deleteFiber:a,isLoading:t}=o.useContext(b),r=Object.values(d).filter(u=>u.type===g.FIBER),[l,c]=o.useState(null);o.useEffect(()=>{const u=r.find(x=>x.name===(e==null?void 0:e.type));c(u)},[e]);const i=u=>c(u);return e?n.jsx(B,{initialValues:{name:(e==null?void 0:e.name)||"",type:(e==null?void 0:e.type)||"",threads:(e==null?void 0:e.threads)||"",serie:(e==null?void 0:e.serie)||"",description:(e==null?void 0:e.description)||""},validationSchema:z({name:I().required("Ingrese el nombre del marcador"),type:I().required("Seleccione el tipo de fibra"),threads:y().required("Seleccione el numero de hilos")}),onSubmit:async u=>{await s(e.id,u)},children:({handleSubmit:u,values:x,handleChange:f,isSubmitting:m})=>n.jsxs("form",{onSubmit:u,className:" flex flex-col ",children:[n.jsx(O,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsx(O,{name:"serie",label:"Serie:",placeholder:"Serie del Cable"}),n.jsx(O,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{className:" flex gap-3 w-full h-full ",children:[n.jsxs("div",{className:" min-w-44 flex flex-col justify-between ",children:[n.jsxs("label",{className:" flex justify-center items-center gap-1  ",children:[n.jsx(R,{text:"Tipo de Fibra:",className:" pl-1 "}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 mr-auto  ",children:l==null?void 0:l.name})]}),n.jsx("div",{className:" flex justify-center gap-1 ",children:n.jsx(ae,{selected:l,onSelect:v=>{i(v),f({target:{name:"type",value:v.name}})}})})]}),n.jsxs("div",{className:" flex-1 flex flex-col justify-between",children:[n.jsx(R,{className:" flex justify-center items-center ",text:"Numero de Hilos:"}),n.jsx(re,{fiberType:l==null?void 0:l.name,value:x.threads,onChange:v=>f({target:{name:"threads",value:v}})})]})]}),n.jsxs("div",{className:" flex mt-4 ",children:[n.jsx("button",{type:"submit",className:p(" flex-1 bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":m||t}),disabled:m||t,children:m?n.jsx(j,{icon:E,spin:!0}):"Guardar"}),n.jsx("button",{type:"button",className:p(" flex-1 bg-red-500 text-white rounded p-3 mt-2 ml-2 uppercase font-bold hover:bg-red-600 ",{" opacity-50 cursor-not-allowed ":t||m}),disabled:t||m,onClick:()=>a(e.id),children:t?n.jsx(j,{icon:E,spin:!0}):"Eliminar"})]})]})}):null}function O({label:e,classInput:s="",classWrap:a,...t}){return n.jsxs("div",{className:p(" flex-1 flex flex-col  ",a),children:[n.jsx(R,{text:e}),n.jsx(K,{name:t.name,className:p(" border rounded p-2 ",s),...t}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(F,{name:t.name})})]})}function R({text:e,className:s}){return n.jsx("label",{className:p(" font-bold text-sm uppercase pl-1 mb-1 ",s),children:e})}function ce({mapRef:e}){const{toolSelected:s}=o.useContext(h),a=o.useRef(!0),{markers:t}=o.useContext(k),{fibers:r}=o.useContext(b);return o.useEffect(()=>{e.current&&(document.querySelector(".leaflet-container").style.cursor=s.cursor)},[s]),o.useEffect(()=>{if(!e.current)return;const l=e.current;t===null||r===null||!Array.isArray(t)||!Array.isArray(r)||t.length===0&&r.length===0||a.current!==!1&&(a.current===!0&&(a.current=!1),l.fitBounds([...t.map(c=>[c.latitude,c.longitude]),...r.map(c=>c.fiber_markers.map(i=>[i.latitude,i.longitude]))]))},[t,r]),{mapRef:e}}function ue(){var i,u;const{fibers:e,fiberSelected:s}=o.useContext(b),{toolSelected:a}=o.useContext(h),[t,r]=o.useState(null),[l,c]=o.useState(null);return o.useEffect(()=>{if(!s)return r(null)},[s]),_({mousemove:x=>{if(c(x),a.type!==g.FIBER||!s)return r(null);const f=e.find(M=>M.id===s.id),m=f==null?void 0:f.fiber_markers;if(!m||m.length<1)return r(null);const v=m==null?void 0:m.map(M=>[M.latitude,M.longitude]);v.push([x.latlng.lat,x.latlng.lng]);const S=A(v);r(n.jsxs(n.Fragment,{children:[n.jsx("p",{className:" text-red-200 ",children:S}),n.jsx("p",{className:" text-white ",children:"Haga clic para continuar dibujando"})]}))}}),n.jsx("div",{className:" absolute z-[400] bg-black/50 p-2 rounded-lg pointer-events-none -translate-y-1/2 whitespace-nowrap ",style:{top:`${(i=l==null?void 0:l.containerPoint)==null?void 0:i.y}px`,left:`${((u=l==null?void 0:l.containerPoint)==null?void 0:u.x)+20}px`,display:t?"block":"none"},children:t})}function de(){const{fibers:e,fiberSelected:s}=o.useContext(b),{toolSelected:a}=o.useContext(h),[t,r]=o.useState(null);return o.useEffect(()=>{if(!s)return r(null)},[s]),_({mousemove:l=>{if(a.type!==g.FIBER||!s)return r(null);const c=e.find(f=>f.id===s.id),i=c==null?void 0:c.fiber_markers;if(!i||i.length<1)return r(null);const u=i[i.length-1],x=[[u.latitude,u.longitude],[l.latlng.lat,l.latlng.lng]];r(x)}}),t?n.jsx($,{pathOptions:{color:a.color,dashArray:"2 10",weight:5},positions:t}):null}function je(){const{isSearching:e,searchLocation:s}=o.useContext(h),{isOpenHeaderOptions:a}=o.useContext(G),{isMarkerFormOpen:t}=o.useContext(k),{isFiberFormOpen:r}=o.useContext(b);return n.jsxs("div",{className:" relative flex w-full h-full ",children:[n.jsx(te,{}),n.jsx(ie,{}),n.jsx("div",{className:p(" relative flex w-full h-full p-7",{" -z-10 ":a||t||r}),children:n.jsxs("div",{className:" flex flex-col w-full h-full rounded-2xl shadow-xl overflow-hidden bg-white ",children:[n.jsxs("div",{className:" flex items-center py-1 px-4 ",children:[Object.values(d).map(l=>n.jsx(me,{tool:l},l.name)),n.jsxs("div",{className:p(" flex items-center border w-full max-w-96 py-2 px-2 ml-auto rounded ",{" bg-black/5 ":e," bg-white ":!e}),children:[n.jsx("input",{onKeyDown:l=>{l.key==="Enter"&&s(l.target.value)&&(l.target.value="")},className:" w-full ",type:"text",placeholder:"Buscar lugar",disabled:e}),e&&n.jsx(j,{icon:E,spin:!0}),!e&&n.jsx(j,{icon:J})]})]}),n.jsx(xe,{})]})})]})}const xe=()=>{const{mapRef:e}=o.useContext(h);return ce({mapRef:e}),n.jsxs(Q,{ref:e,className:p(" flex w-full h-full cursor-pointer "),center:[-2.3093213892775175,-78.12541130262117],zoom:3,children:[n.jsx(U,{}),n.jsx(W,{}),n.jsx(X,{}),n.jsx(ue,{}),n.jsx(de,{})]})};function me({tool:e}){const{toolSelected:s,selectTool:a}=o.useContext(h),t=s.name===e.name,r=typeof e.icon=="string";return n.jsxs("button",{onClick:()=>a(e),className:p(" flex flex-col justify-between items-center py-1 px-3 h-full rounded transition-all hover:bg-black/5 hover:scale-110 ",{" opacity-80  ":!t," bg-black/5 hover:scale-100 ":t}),style:{color:e.color},children:[r?n.jsx("img",{className:" h-full max-h-6 aspect-square object-contain",src:e.icon,alt:e.name}):n.jsx(j,{className:"text-lg",icon:e.icon}),n.jsx("p",{className:" text-black text-[10.5px] ",children:e.name})]})}export{je as default};
