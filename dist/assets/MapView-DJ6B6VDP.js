import{r as i,u as M,M as p,A as b,t as o,j as t,i as v,B as O,C as N,k as H,H as S,c as x,F as w,p as T,D as j}from"./index-DqvCPm-0.js";import{u as R,b as y,P as C,c as P,M as V,a as A}from"./MapLayerControl-BZMbI4UJ.js";function L(){return R().map}function k(n){const e=L();return i.useEffect(function(){return e.on(n),function(){e.off(n)}},[e,n]),e}function F(){const{map_id:n}=M(),{toolSelected:e}=i.useContext(p),{markers:c,addMarker:u,moveMarker:d,removeMarker:m}=i.useContext(b);if(k({click(s){e.type===O.MARKER&&u({latitude:s.latlng.lat,longitude:s.latlng.lng,type:e.name,map_id:n})}}),!(!c||c===null))return c.map(s=>{const l=Object.values(o).find(a=>a.name===s.type);return t.jsx(y,{position:{lat:s.latitude,lng:s.longitude},draggable:e.name===o.MOVE.name,icon:v({width:45,height:45,icon:l.icon}),eventHandlers:{click:()=>{e.name===o.TRASH.name&&m(s.id)},dblclick:()=>{console.log("hola")},dragend:a=>{e.name===o.MOVE.name&&d(a,s.id)}},children:t.jsx(C,{children:s.name_auto})},s.id)})}function _(){const{map_id:n}=M(),{fibers:e,handleClick:c,handleLineClick:u,handleDrag:d,onToolChange:m,removeFiberMarker:s}=i.useContext(N),{toolSelected:l}=i.useContext(p);if(i.useEffect(()=>{m()},[l]),k({click:a=>c(a,n,l)}),!(!e||e===null))return e==null?void 0:e.map(a=>{var g;const f=(g=a==null?void 0:a.fiber_markers)==null?void 0:g.map(r=>({lat:r.latitude,lng:r.longitude})),h=Object.values(o).find(r=>r.name===a.type);return t.jsxs("div",{children:[t.jsx(P,{pathOptions:{color:h.color},positions:f,weight:h.weight,eventHandlers:{click:r=>{l.name===o.MOVE.name&&u(r,a.id)}},children:l.name===o.POINTER.name&&t.jsx(C,{children:H(f)})}),(l.name===o.MOVE.name||l.name===o.TRASH.name)&&a.fiber_markers.map(r=>t.jsx(y,{position:{lat:r.latitude,lng:r.longitude},icon:v({width:20,height:20,icon:"/point.png"}),draggable:l.name===o.MOVE.name,eventHandlers:{click:()=>{l.name===o.TRASH.name&&s(r)},dragend:E=>{l.name===o.MOVE.name&&d(E,r)}}},r.id))]},a.id)})}function K(){const{isOpenHeaderOptions:n}=i.useContext(S);return t.jsx("div",{className:x(" relative flex w-full h-full p-7",{" -z-10 ":n}),children:t.jsxs("div",{className:" flex flex-col w-full h-full rounded-2xl shadow-xl overflow-hidden bg-white ",children:[t.jsxs("div",{className:" flex items-center py-1 px-4 ",children:[Object.values(o).map(e=>t.jsx(D,{tool:e},e.name)),t.jsxs("div",{className:" flex items-center border w-full max-w-96 py-2 px-2 ml-auto rounded ",children:[t.jsx("input",{className:" w-full ",type:"text",placeholder:"Buscar lugar"}),t.jsx(w,{icon:T})]})]}),t.jsx(q,{})]})})}const I=async n=>await(await fetch(`https://nominatim.openstreetmap.org/search?q=${n}&format=json`)).json(),q=()=>{const{toolSelected:n}=i.useContext(p),e=i.useRef(null);return i.useEffect(()=>{if(e.current){const c=e.current;(async d=>{const m=await I(d);if(m.length>0){const{lat:s,lon:l}=m[0],a=j.latLng(s,l);j.marker(a).addTo(c).bindPopup("UbicaciÃ³n encontrada").openPopup(),c.setView(a,13)}})("New York")}},[]),i.useEffect(()=>{e.current&&(document.querySelector(".leaflet-container").style.cursor=n.cursor)},[n]),t.jsxs(V,{ref:e,className:x(" flex w-full h-full cursor-pointer "),center:{lat:-2.3093213892775175,lng:-78.12541130262117},zoom:16,style:{height:"100%",width:"100%"},children:[t.jsx(A,{}),t.jsx(F,{}),t.jsx(_,{})]})};function D({tool:n}){const{toolSelected:e,selectTool:c}=i.useContext(p),u=e.name===n.name,d=typeof n.icon=="string";return t.jsxs("button",{onClick:()=>c(n),className:x(" flex flex-col justify-between items-center py-1 px-3 h-full rounded transition-all hover:bg-black/5 hover:scale-110 ",{" opacity-80  ":!u," bg-black/5 hover:scale-100 ":u}),style:{color:n.color},children:[d?t.jsx("img",{className:" h-full max-h-6 aspect-square object-contain",src:n.icon,alt:n.name}):t.jsx(w,{className:"text-lg",icon:n.icon}),t.jsx("p",{className:" text-black text-[10.5px] ",children:n.name})]})}export{K as default};
