import{r as l,u as O,M as w,z as M,t as d,j as n,h as F,A as N,B as L,i as A,C as E,c as x,F as C,D as H,H as T,o as V,E as _}from"./index-DzMWutE2.js";import{u as D,b as R,P,c as $,M as z,a as K}from"./MapLayerControl-BAJTaj97.js";import{F as B,c as G,a as U,d as j,E as y,b as Y}from"./index.esm-DSlCy5go.js";function J(){return D().map}function q(e){const t=J();return l.useEffect(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}function Q(){const{map_id:e}=O(),{toolSelected:t}=l.useContext(w),{markers:a,addMarker:s,moveMarker:c,removeMarker:u,openMarkerForm:i}=l.useContext(M);if(q({click(r){t.type===N.MARKER&&s({latitude:r.latlng.lat,longitude:r.latlng.lng,type:t.name,map_id:e})}}),!(!a||a===null))return a.map(r=>{const o=Object.values(d).find(m=>m.name===r.type);return n.jsx(R,{position:{lat:r.latitude,lng:r.longitude},draggable:t.name===d.MOVE.name,icon:F({width:45,height:45,icon:o.icon}),eventHandlers:{click:()=>{t.name===d.TRASH.name&&u(r.id)},dblclick:()=>{i(r)},dragend:m=>{t.name===d.MOVE.name&&c(m,r.id)}},children:n.jsx(P,{children:r.name_auto})},r.id)})}function S(){const{map_id:e}=O(),{fibers:t,handleClick:a,handleLineClick:s,handleDrag:c,onToolChange:u,removeFiberMarker:i}=l.useContext(L),{toolSelected:r}=l.useContext(w);if(l.useEffect(()=>{u()},[r]),q({click:o=>a(o,e,r)}),!(!t||t===null))return t==null?void 0:t.map(o=>{var h;const m=(h=o==null?void 0:o.fiber_markers)==null?void 0:h.map(p=>({lat:p.latitude,lng:p.longitude})),f=Object.values(d).find(p=>p.name===o.type);return n.jsxs("div",{children:[n.jsx($,{pathOptions:{color:f.color},positions:m,weight:f.weight,eventHandlers:{click:p=>{r.name===d.MOVE.name&&s(p,o.id)}},children:r.name===d.POINTER.name&&n.jsx(P,{children:A(m)})}),(r.name===d.MOVE.name||r.name===d.TRASH.name)&&o.fiber_markers.map(p=>n.jsx(R,{position:{lat:p.latitude,lng:p.longitude},icon:F({width:20,height:20,icon:"/point.png"}),draggable:r.name===d.MOVE.name,eventHandlers:{click:()=>{r.name===d.TRASH.name&&i(p)},dragend:I=>{r.name===d.MOVE.name&&c(I,p)}}},p.id))]},o.id)})}function k({value:e,onChange:t}){const[a,s]=l.useState(e),c=(u,i)=>{s(u),t&&t(u,i)};return l.useEffect(()=>{s(e)},[e]),n.jsx("div",{className:" grid grid-cols-6 gap-1 ",children:Object.values(E).map((u,i)=>{const r=Object.keys(E)[i],o=a===u||a==r;return n.jsx("div",{className:x(" flex w-8 aspect-square rounded-full border  border-transparent transition hover:scale-110 ",{" border-black ":o}),children:n.jsx("button",{onClick:()=>c(u,r),type:"button",className:x(" w-full h-full rounded-full shadow-lg border-2 border-transparent transition ",{" border-green-400 ":o}),style:{backgroundColor:u}})},i)})})}function W({value:e,onChange:t}){const[a,s]=l.useState(e),c=u=>()=>{s(u),t&&t(u)};return l.useEffect(()=>{s(e)},[e]),n.jsxs("div",{className:" flex gap-2 ",children:[n.jsx(v,{label:2,selected:a,onClick:c(2)}),n.jsx(v,{label:4,selected:a,onClick:c(4)}),n.jsx(v,{label:8,selected:a,onClick:c(8)}),n.jsx(v,{label:16,selected:a,onClick:c(16)})]})}function v({label:e,selected:t,...a}){const s=t==e;return n.jsx("button",{type:"button",className:x(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 ":s}),...a,children:n.jsx("span",{className:" font-normal ",children:e})})}function X({selected:e,onSelect:t}){const a=Object.values(d).filter(s=>s.type===N.MARKER);return e||(e=a[0]),n.jsx(n.Fragment,{children:a.map(s=>n.jsx("button",{type:"button",className:x(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg ",{" bg-black/10":s.name===e.name}),onClick:()=>t(s),children:n.jsx("img",{className:"w-full h-full object-contain",src:s.icon,alt:s.name})},s.name))})}function Z(){const e=l.useRef(null),{isMarkerFormOpen:t,closeMarkerForm:a}=l.useContext(M);return l.useEffect(()=>{const s=c=>c.key==="Escape"&&a();return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.current&&(e.current.onclick=s=>{s.target===e.current&&a()}),n.jsx("div",{className:x(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!t}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:a,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(C,{icon:H})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar"}),n.jsx(ee,{})]})})}function ee(){const{markerSelected:e,updateMarker:t}=l.useContext(M),a=Object.values(d).filter(i=>i.type===N.MARKER),[s,c]=l.useState(null);l.useEffect(()=>{const i=a.find(r=>r.name===(e==null?void 0:e.type));c(i)},[e]);const u=i=>c(i);return e?n.jsx(B,{initialValues:{name:(e==null?void 0:e.name)||"",latitude:(e==null?void 0:e.latitude)||"",longitude:(e==null?void 0:e.longitude)||"",description:(e==null?void 0:e.description)||"",type:(e==null?void 0:e.type)||"",reserve_meters:(e==null?void 0:e.reserve_meters)||1,nap_buffer:(e==null?void 0:e.nap_buffer)||1,nap_thread:(e==null?void 0:e.nap_thread)||1,nap_ports:(e==null?void 0:e.nap_ports)||1},validationSchema:G({name:U().required("Ingrese el nombre del marcador"),latitude:j().required("Ingrese la latitud"),longitude:j().required("Ingrese la longitud"),reserve_meters:j().required("Ingrese los metros de reserva"),nap_buffer:j().required("Ingrese el buffer"),nap_thread:j().required("Ingrese el puerto"),nap_ports:j().required("Ingrese el numero de puertos")}),onSubmit:async i=>{await t(e.id,i)},children:({handleSubmit:i,values:r,handleChange:o,isSubmitting:m})=>n.jsxs("form",{onSubmit:i,className:" flex flex-col ",children:[n.jsx(b,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsx("input",{type:"text"}),n.jsxs("div",{className:" flex gap-3 ",children:[n.jsx(b,{name:"latitude",label:"Latitud:",placeholder:"Latitud"}),n.jsx(b,{name:"longitude",label:"Longitud:",placeholder:"Longitud"})]}),n.jsx(b,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{children:[n.jsxs("label",{className:" flex items-center gap-1 ",children:[n.jsx(g,{text:"Tipo de Marcador:"}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 ",children:s==null?void 0:s.name})]}),n.jsx("div",{className:" flex justify-evenly ",children:n.jsx(X,{selected:s,onSelect:f=>{u(f),o({target:{name:"type",value:f.name}})}})})]}),(s==null?void 0:s.name)===d.RESERVA.name&&n.jsx(b,{name:"reserve_meters",type:"number",label:"METROS:",placeholder:"Metros de reserva"}),((s==null?void 0:s.name)===d.NAP1.name||(s==null?void 0:s.name)===d.NAP2.name)&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:" flex gap-4 ",children:[n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(g,{text:"Buffer:"}),n.jsx(k,{onChange:(f,h)=>o({target:{name:"nap_buffer",value:h}}),value:r.nap_buffer}),n.jsx(y,{name:"nap_buffer"})]}),n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(g,{text:"Hilo:"}),n.jsx(k,{onChange:(f,h)=>o({target:{name:"nap_thread",value:h}}),value:r.nap_thread}),n.jsx(y,{name:"nap_thread"})]})]}),n.jsxs("div",{children:[n.jsx(g,{text:"Numero de Puertos:"}),n.jsx(W,{value:r.nap_ports})]})]}),n.jsx("button",{type:"submit",className:x(" bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":m}),children:"Guardar"})]})}):null}function b({label:e,classInput:t="",...a}){return n.jsxs("div",{className:" flex-1 flex flex-col ",children:[n.jsx(g,{text:e}),n.jsx(Y,{name:a.name,className:x(" border rounded p-2 ",t),...a}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(y,{name:a.name})})]})}function g({text:e,className:t}){return n.jsx("label",{className:x(" font-bold text-sm uppercase pl-1 mb-1 ",t),children:e})}function oe(){const{isOpenHeaderOptions:e}=l.useContext(T),{isMarkerFormOpen:t}=l.useContext(M);return n.jsxs("div",{className:" relative flex w-full h-full ",children:[n.jsx(Z,{}),n.jsx("div",{className:x(" relative flex w-full h-full p-7",{" -z-10 ":e||t}),children:n.jsxs("div",{className:" flex flex-col w-full h-full rounded-2xl shadow-xl overflow-hidden bg-white ",children:[n.jsxs("div",{className:" flex items-center py-1 px-4 ",children:[Object.values(d).map(a=>n.jsx(se,{tool:a},a.name)),n.jsxs("div",{className:" flex items-center border w-full max-w-96 py-2 px-2 ml-auto rounded ",children:[n.jsx("input",{className:" w-full ",type:"text",placeholder:"Buscar lugar"}),n.jsx(C,{icon:V})]})]}),n.jsx(te,{})]})})]})}const ne=async e=>await(await fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json`)).json(),te=()=>{const{toolSelected:e}=l.useContext(w),t=l.useRef(null);return l.useEffect(()=>{if(t.current){const a=t.current;(async c=>{const u=await ne(c);if(u.length>0){const{lat:i,lon:r}=u[0],o=_.latLng(i,r);_.marker(o).addTo(a).bindPopup("UbicaciÃ³n encontrada").openPopup(),a.setView(o,13)}})("New York")}},[]),l.useEffect(()=>{t.current&&(document.querySelector(".leaflet-container").style.cursor=e.cursor)},[e]),n.jsxs(z,{ref:t,className:x(" flex w-full h-full cursor-pointer "),center:{lat:-2.3093213892775175,lng:-78.12541130262117},zoom:16,style:{height:"100%",width:"100%"},children:[n.jsx(K,{}),n.jsx(Q,{}),n.jsx(S,{})]})};function se({tool:e}){const{toolSelected:t,selectTool:a}=l.useContext(w),s=t.name===e.name,c=typeof e.icon=="string";return n.jsxs("button",{onClick:()=>a(e),className:x(" flex flex-col justify-between items-center py-1 px-3 h-full rounded transition-all hover:bg-black/5 hover:scale-110 ",{" opacity-80  ":!s," bg-black/5 hover:scale-100 ":s}),style:{color:e.color},children:[c?n.jsx("img",{className:" h-full max-h-6 aspect-square object-contain",src:e.icon,alt:e.name}):n.jsx(C,{className:"text-lg",icon:e.icon}),n.jsx("p",{className:" text-black text-[10.5px] ",children:e.name})]})}export{oe as default};
