import{r,u as L,M as k,z as E,t as d,j as n,h as A,A as w,B as C,i as G,C as I,c as m,F as j,D as H,b as O,H as U,o as Y,E as q}from"./index-6Fz3NX-Z.js";import{u as J,b as D,P as T,c as Q,M as W,a as X}from"./MapLayerControl-Bn298cuB.js";import{F as V,c as $,a as _,d as g,E as M,b as z}from"./index.esm-DUHU-ldu.js";function Z(){return J().map}function B(e){const a=Z();return r.useEffect(function(){return a.on(e),function(){a.off(e)}},[a,e]),a}function S(){const{map_id:e}=L(),{toolSelected:a}=r.useContext(k),{markers:t,addMarker:s,moveMarker:i,removeMarker:c,openMarkerForm:o}=r.useContext(E);if(B({click(u){a.type===w.MARKER&&s({latitude:u.latlng.lat,longitude:u.latlng.lng,type:a.name,map_id:e})}}),!(!t||t===null))return t.map(u=>{const l=Object.values(d).find(x=>x.name===u.type);return n.jsx(D,{position:{lat:u.latitude,lng:u.longitude},draggable:a.name===d.MOVE.name,icon:A({width:45,height:45,icon:l.icon}),eventHandlers:{click:()=>{a.name===d.TRASH.name&&c(u.id)},dblclick:()=>{o(u)},dragend:x=>{a.name===d.MOVE.name&&i(x,u.id)}},children:n.jsx(T,{children:u.name_auto})},u.id)})}function ee(){const{map_id:e}=L(),{fibers:a,handleClick:t,handleLineClick:s,handleDrag:i,onToolChange:c,removeFiberMarker:o,openFiberForm:u}=r.useContext(C),{toolSelected:l}=r.useContext(k);if(r.useEffect(()=>{c()},[l]),B({click:x=>t(x,e,l)}),!(!a||a===null))return a==null?void 0:a.map(x=>{var b;const h=(b=x==null?void 0:x.fiber_markers)==null?void 0:b.map(f=>({lat:f.latitude,lng:f.longitude})),p=Object.values(d).find(f=>f.name===x.type);return n.jsxs("div",{children:[n.jsx(Q,{pathOptions:{color:p.color},positions:h,weight:p.weight,eventHandlers:{click:f=>{l.name===d.MOVE.name&&s(f,x.id)},dblclick:()=>{l.name===d.POINTER.name&&u(x)}},children:l.name===d.POINTER.name&&n.jsx(T,{children:G(h)})}),(l.name===d.MOVE.name||l.name===d.TRASH.name)&&x.fiber_markers.map(f=>n.jsx(D,{position:{lat:f.latitude,lng:f.longitude},icon:A({width:20,height:20,icon:"/point.png"}),draggable:l.name===d.MOVE.name,eventHandlers:{click:()=>{l.name===d.TRASH.name&&o(f)},dragend:K=>{l.name===d.MOVE.name&&i(K,f)}}},f.id))]},x.id)})}function P({value:e,onChange:a}){const[t,s]=r.useState(e),i=(c,o)=>{s(c),a&&a(c,o)};return r.useEffect(()=>{s(e)},[e]),n.jsx("div",{className:" grid grid-cols-6 gap-1 ",children:Object.values(I).map((c,o)=>{const u=Object.keys(I)[o],l=t===c||t==u;return n.jsx("div",{className:m(" flex w-8 aspect-square rounded-full border  border-transparent transition hover:scale-110 ",{" border-black ":l}),children:n.jsx("button",{onClick:()=>i(c,u),type:"button",className:m(" w-full h-full rounded-full shadow-lg border-2 border-transparent transition ",{" border-green-400 ":l}),style:{backgroundColor:c}})},o)})})}function ne({selected:e,onSelect:a}){const t=Object.values(d).filter(s=>s.type===w.MARKER);return e||(e=t[0]),n.jsx(n.Fragment,{children:t.map(s=>n.jsx("button",{type:"button",className:m(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg ",{" bg-black/10":s.name===e.name}),onClick:()=>a(s),children:n.jsx("img",{className:"w-full h-full object-contain",src:s.icon,alt:s.name})},s.name))})}function se({value:e,onChange:a}){const[t,s]=r.useState(e),i=c=>()=>{s(c),a&&a(c)};return r.useEffect(()=>{s(e)},[e]),n.jsxs("div",{className:" flex gap-2 ",children:[n.jsx(y,{label:2,selected:t,onClick:i(2)}),n.jsx(y,{label:4,selected:t,onClick:i(4)}),n.jsx(y,{label:8,selected:t,onClick:i(8)}),n.jsx(y,{label:16,selected:t,onClick:i(16)})]})}function y({label:e,selected:a,...t}){const s=a==e;return n.jsx("button",{type:"button",className:m(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 ":s}),...t,children:n.jsx("span",{className:" font-normal ",children:e})})}function ae(){const e=r.useRef(null),{isMarkerFormOpen:a,closeMarkerForm:t}=r.useContext(E);return r.useEffect(()=>{const s=i=>i.key==="Escape"&&t();return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.current&&(e.current.onclick=s=>{s.target===e.current&&t()}),n.jsx("div",{className:m(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!a}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:t,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(j,{icon:H})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar"}),n.jsx(te,{})]})})}function te(){const{markerSelected:e,updateMarker:a}=r.useContext(E),t=Object.values(d).filter(o=>o.type===w.MARKER),[s,i]=r.useState(null);r.useEffect(()=>{const o=t.find(u=>u.name===(e==null?void 0:e.type));i(o)},[e]);const c=o=>i(o);return e?n.jsx(V,{initialValues:{name:(e==null?void 0:e.name)||"",latitude:(e==null?void 0:e.latitude)||"",longitude:(e==null?void 0:e.longitude)||"",description:(e==null?void 0:e.description)||"",type:(e==null?void 0:e.type)||"",reserve_meters:(e==null?void 0:e.reserve_meters)||1,nap_buffer:(e==null?void 0:e.nap_buffer)||1,nap_thread:(e==null?void 0:e.nap_thread)||1,nap_ports:(e==null?void 0:e.nap_ports)||1},validationSchema:$({name:_().required("Ingrese el nombre del marcador"),latitude:g().required("Ingrese la latitud"),longitude:g().required("Ingrese la longitud"),reserve_meters:g().required("Ingrese los metros de reserva"),nap_buffer:g().required("Ingrese el buffer"),nap_thread:g().required("Ingrese el puerto"),nap_ports:g().required("Ingrese el numero de puertos")}),onSubmit:async o=>{await a(e.id,o)},children:({handleSubmit:o,values:u,handleChange:l,isSubmitting:x})=>n.jsxs("form",{onSubmit:o,className:" flex flex-col ",children:[n.jsx(v,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsxs("div",{className:" flex gap-3 ",children:[n.jsx(v,{name:"latitude",label:"Latitud:",placeholder:"Latitud"}),n.jsx(v,{name:"longitude",label:"Longitud:",placeholder:"Longitud"})]}),n.jsx(v,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{children:[n.jsxs("label",{className:" flex items-center gap-1 ",children:[n.jsx(N,{text:"Tipo de Marcador:"}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 ",children:s==null?void 0:s.name})]}),n.jsx("div",{className:" flex justify-evenly ",children:n.jsx(ne,{selected:s,onSelect:h=>{c(h),l({target:{name:"type",value:h.name}})}})})]}),(s==null?void 0:s.name)===d.RESERVA.name&&n.jsx(v,{name:"reserve_meters",type:"number",label:"METROS:",placeholder:"Metros de reserva"}),((s==null?void 0:s.name)===d.NAP1.name||(s==null?void 0:s.name)===d.NAP2.name)&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:" flex gap-4 ",children:[n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(N,{text:"Buffer:"}),n.jsx(P,{onChange:(h,p)=>l({target:{name:"nap_buffer",value:p}}),value:u.nap_buffer}),n.jsx(M,{name:"nap_buffer"})]}),n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(N,{text:"Hilo:"}),n.jsx(P,{onChange:(h,p)=>l({target:{name:"nap_thread",value:p}}),value:u.nap_thread}),n.jsx(M,{name:"nap_thread"})]})]}),n.jsxs("div",{children:[n.jsx(N,{text:"Numero de Puertos:"}),n.jsx(se,{value:u.nap_ports})]})]}),n.jsx("button",{type:"submit",className:m(" bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":x}),disabled:x,children:x?n.jsx(j,{icon:O,spin:!0}):"Guardar"})]})}):null}function v({label:e,classInput:a="",...t}){return n.jsxs("div",{className:" flex-1 flex flex-col ",children:[n.jsx(N,{text:e}),n.jsx(z,{name:t.name,className:m(" border rounded p-2 ",a),...t}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(M,{name:t.name})})]})}function N({text:e,className:a}){return n.jsx("label",{className:m(" font-bold text-sm uppercase pl-1 mb-1 ",a),children:e})}function re({selected:e,onSelect:a}){const t=Object.values(d).filter(s=>s.type===w.FIBER);return e||(e=t[0]),n.jsx(n.Fragment,{children:t.map(s=>n.jsxs("button",{type:"button",className:m(" flex flex-col justify-center items-center w-[52px] aspect-square bg-transparent transition-all duration-300 py-1 px-1.5 rounded-lg hover:bg-black/5 ",{" bg-black/10 hover:bg-black/10 ":s.name===e.name}),onClick:()=>a(s),children:[n.jsx(j,{style:{color:s.color},className:"text-lg",icon:s.icon}),n.jsx("span",{className:" text-xs leading-3 ",children:s.name})]},s.name))})}function le({fiberType:e,value:a,onChange:t}){const[s,i]=r.useState(null),c=o=>{t&&t(o)};return r.useEffect(()=>{e&&(e===d.DROP.name&&i([1,2,4,6,8,12]),e===d.MINI_ADSS.name&&i([6,8,12,24,48]),e===d.ADSS.name&&i([12,24,48,72,96]))},[e]),r.useEffect(()=>{s&&(s.includes(a)||c(s[0]))},[s]),e?n.jsx("div",{className:" flex justify-center gap-1 ",children:s==null?void 0:s.map(o=>n.jsx(ce,{label:o,selected:a,onClick:()=>c(o)},o))}):null}function ce({label:e,selected:a,...t}){const s=a==e;return n.jsx("button",{type:"button",className:m(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 hover:bg-black/10 ":s}),...t,children:n.jsx("span",{className:" font-normal ",children:e})})}function oe(){const e=r.useRef(null),{isFiberFormOpen:a,closeFiberForm:t}=r.useContext(C);return r.useEffect(()=>{const s=i=>i.key==="Escape"&&t();return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.current&&(e.current.onclick=s=>{s.target===e.current&&t()}),n.jsx("div",{className:m(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!a}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:t,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(j,{icon:H})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar Fibra"}),n.jsx(ie,{})]})})}function ie(){const{fiberSelected:e,updateFiber:a,deleteFiber:t,isLoading:s}=r.useContext(C),i=Object.values(d).filter(l=>l.type===w.FIBER),[c,o]=r.useState(null);r.useEffect(()=>{const l=i.find(x=>x.name===(e==null?void 0:e.type));o(l)},[e]);const u=l=>o(l);return e?n.jsx(V,{initialValues:{name:(e==null?void 0:e.name)||"",type:(e==null?void 0:e.type)||"",threads:(e==null?void 0:e.threads)||"",serie:(e==null?void 0:e.serie)||"",description:(e==null?void 0:e.description)||""},validationSchema:$({name:_().required("Ingrese el nombre del marcador"),type:_().required("Seleccione el tipo de fibra"),threads:g().required("Seleccione el numero de hilos")}),onSubmit:async l=>{await a(e.id,l)},children:({handleSubmit:l,values:x,handleChange:h,isSubmitting:p})=>n.jsxs("form",{onSubmit:l,className:" flex flex-col ",children:[n.jsx(F,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsx(F,{name:"serie",label:"Serie:",placeholder:"Serie del Cable"}),n.jsx(F,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{className:" flex gap-3 w-full h-full ",children:[n.jsxs("div",{className:" min-w-44 flex flex-col justify-between ",children:[n.jsxs("label",{className:" flex justify-center items-center gap-1  ",children:[n.jsx(R,{text:"Tipo de Fibra:",className:" pl-1 "}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 mr-auto  ",children:c==null?void 0:c.name})]}),n.jsx("div",{className:" flex justify-center gap-1 ",children:n.jsx(re,{selected:c,onSelect:b=>{u(b),h({target:{name:"type",value:b.name}})}})})]}),n.jsxs("div",{className:" flex-1 flex flex-col justify-between",children:[n.jsx(R,{className:" flex justify-center items-center ",text:"Numero de Hilos:"}),n.jsx(le,{fiberType:c==null?void 0:c.name,value:x.threads,onChange:b=>h({target:{name:"threads",value:b}})})]})]}),n.jsxs("div",{className:" flex mt-4 ",children:[n.jsx("button",{type:"submit",className:m(" flex-1 bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":p||s}),disabled:p||s,children:p?n.jsx(j,{icon:O,spin:!0}):"Guardar"}),n.jsx("button",{type:"button",className:m(" flex-1 bg-red-500 text-white rounded p-3 mt-2 ml-2 uppercase font-bold hover:bg-red-600 ",{" opacity-50 cursor-not-allowed ":s||p}),disabled:s||p,onClick:()=>t(e.id),children:s?n.jsx(j,{icon:O,spin:!0}):"Eliminar"})]})]})}):null}function F({label:e,classInput:a="",classWrap:t,...s}){return n.jsxs("div",{className:m(" flex-1 flex flex-col  ",t),children:[n.jsx(R,{text:e}),n.jsx(z,{name:s.name,className:m(" border rounded p-2 ",a),...s}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(M,{name:s.name})})]})}function R({text:e,className:a}){return n.jsx("label",{className:m(" font-bold text-sm uppercase pl-1 mb-1 ",a),children:e})}function he(){const{isOpenHeaderOptions:e}=r.useContext(U),{isMarkerFormOpen:a}=r.useContext(E),{isFiberFormOpen:t}=r.useContext(C);return n.jsxs("div",{className:" relative flex w-full h-full ",children:[n.jsx(ae,{}),n.jsx(oe,{}),n.jsx("div",{className:m(" relative flex w-full h-full p-7",{" -z-10 ":e||a||t}),children:n.jsxs("div",{className:" flex flex-col w-full h-full rounded-2xl shadow-xl overflow-hidden bg-white ",children:[n.jsxs("div",{className:" flex items-center py-1 px-4 ",children:[Object.values(d).map(s=>n.jsx(xe,{tool:s},s.name)),n.jsxs("div",{className:" flex items-center border w-full max-w-96 py-2 px-2 ml-auto rounded ",children:[n.jsx("input",{className:" w-full ",type:"text",placeholder:"Buscar lugar"}),n.jsx(j,{icon:Y})]})]}),n.jsx(de,{})]})})]})}const ue=async e=>await(await fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json`)).json(),de=()=>{const{toolSelected:e}=r.useContext(k),a=r.useRef(null);return r.useEffect(()=>{if(a.current){const t=a.current;(async i=>{const c=await ue(i);if(c.length>0){const{lat:o,lon:u}=c[0],l=q.latLng(o,u);q.marker(l).addTo(t).bindPopup("Ubicación encontrada").openPopup(),t.setView(l,13)}})("New York")}},[]),r.useEffect(()=>{a.current&&(document.querySelector(".leaflet-container").style.cursor=e.cursor)},[e]),n.jsxs(W,{ref:a,className:m(" flex w-full h-full cursor-pointer "),center:{lat:-2.3093213892775175,lng:-78.12541130262117},zoom:16,style:{height:"100%",width:"100%"},children:[n.jsx(X,{}),n.jsx(S,{}),n.jsx(ee,{})]})};function xe({tool:e}){const{toolSelected:a,selectTool:t}=r.useContext(k),s=a.name===e.name,i=typeof e.icon=="string";return n.jsxs("button",{onClick:()=>t(e),className:m(" flex flex-col justify-between items-center py-1 px-3 h-full rounded transition-all hover:bg-black/5 hover:scale-110 ",{" opacity-80  ":!s," bg-black/5 hover:scale-100 ":s}),style:{color:e.color},children:[i?n.jsx("img",{className:" h-full max-h-6 aspect-square object-contain",src:e.icon,alt:e.name}):n.jsx(j,{className:"text-lg",icon:e.icon}),n.jsx("p",{className:" text-black text-[10.5px] ",children:e.name})]})}export{he as default};
