import{u as A,r,M as v,z as w,t as d,j as n,h as P,A as M,B as k,i as z,C as R,c as m,F as b,D as L,b as E,H as G,o as J}from"./index-Cdxa5cZc.js";import{u as D,b as H,P as T,c as Q,M as U,a as W}from"./MapLayerControl-DRSd0Ql1.js";import{F as V,c as $,a as _,d as g,E as F,b as B}from"./index.esm-BSZPk9PI.js";function X(){const{map_id:e}=A(),{toolSelected:a}=r.useContext(v),{markers:t,addMarker:s,moveMarker:i,removeMarker:l,openMarkerForm:c}=r.useContext(w);if(D({click(u){a.type===M.MARKER&&s({latitude:u.latlng.lat,longitude:u.latlng.lng,type:a.name,map_id:e})}}),!(!t||t===null))return t.map(u=>{const o=Object.values(d).find(x=>x.name===u.type);return n.jsx(H,{position:{lat:u.latitude,lng:u.longitude},draggable:a.name===d.MOVE.name,icon:P({width:45,height:45,icon:o.icon}),eventHandlers:{click:()=>{a.name===d.TRASH.name&&l(u.id)},dblclick:()=>{c(u)},dragend:x=>{a.name===d.MOVE.name&&i(x,u.id)}},children:n.jsx(T,{children:u.name_auto})},u.id)})}function Y(){const{map_id:e}=A(),{fibers:a,handleClick:t,handleLineClick:s,handleDrag:i,onToolChange:l,removeFiberMarker:c,openFiberForm:u}=r.useContext(k),{toolSelected:o}=r.useContext(v);if(r.useEffect(()=>{l()},[o]),D({click:x=>t(x,e,o)}),!(!a||a===null))return a==null?void 0:a.map(x=>{var j;const h=(j=x==null?void 0:x.fiber_markers)==null?void 0:j.map(f=>({lat:f.latitude,lng:f.longitude})),p=Object.values(d).find(f=>f.name===x.type);return n.jsxs("div",{children:[n.jsx(Q,{pathOptions:{color:p.color},positions:h,weight:p.weight,eventHandlers:{click:f=>{o.name===d.MOVE.name&&s(f,x.id)},dblclick:()=>{o.name===d.POINTER.name&&u(x)}},children:o.name===d.POINTER.name&&n.jsx(T,{children:z(h)})}),(o.name===d.MOVE.name||o.name===d.TRASH.name)&&x.fiber_markers.map(f=>n.jsx(H,{position:{lat:f.latitude,lng:f.longitude},icon:P({width:20,height:20,icon:"/point.png"}),draggable:o.name===d.MOVE.name,eventHandlers:{click:()=>{o.name===d.TRASH.name&&c(f)},dragend:K=>{o.name===d.MOVE.name&&i(K,f)}}},f.id))]},x.id)})}function q({value:e,onChange:a}){const[t,s]=r.useState(e),i=(l,c)=>{s(l),a&&a(l,c)};return r.useEffect(()=>{s(e)},[e]),n.jsx("div",{className:" grid grid-cols-6 gap-1 ",children:Object.values(R).map((l,c)=>{const u=Object.keys(R)[c],o=t===l||t==u;return n.jsx("div",{className:m(" flex w-8 aspect-square rounded-full border  border-transparent transition hover:scale-110 ",{" border-black ":o}),children:n.jsx("button",{onClick:()=>i(l,u),type:"button",className:m(" w-full h-full rounded-full shadow-lg border-2 border-transparent transition ",{" border-green-400 ":o}),style:{backgroundColor:l}})},c)})})}function Z({selected:e,onSelect:a}){const t=Object.values(d).filter(s=>s.type===M.MARKER);return e||(e=t[0]),n.jsx(n.Fragment,{children:t.map(s=>n.jsx("button",{type:"button",className:m(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg ",{" bg-black/10":s.name===e.name}),onClick:()=>a(s),children:n.jsx("img",{className:"w-full h-full object-contain",src:s.icon,alt:s.name})},s.name))})}function S({value:e,onChange:a}){const[t,s]=r.useState(e),i=l=>()=>{s(l),a&&a(l)};return r.useEffect(()=>{s(e)},[e]),n.jsxs("div",{className:" flex gap-2 ",children:[n.jsx(C,{label:2,selected:t,onClick:i(2)}),n.jsx(C,{label:4,selected:t,onClick:i(4)}),n.jsx(C,{label:8,selected:t,onClick:i(8)}),n.jsx(C,{label:16,selected:t,onClick:i(16)})]})}function C({label:e,selected:a,...t}){const s=a==e;return n.jsx("button",{type:"button",className:m(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 ":s}),...t,children:n.jsx("span",{className:" font-normal ",children:e})})}function ee(){const e=r.useRef(null),{isMarkerFormOpen:a,closeMarkerForm:t}=r.useContext(w);return r.useEffect(()=>{const s=i=>i.key==="Escape"&&t();return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.current&&(e.current.onclick=s=>{s.target===e.current&&t()}),n.jsx("div",{className:m(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!a}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:t,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(b,{icon:L})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar"}),n.jsx(ne,{})]})})}function ne(){const{markerSelected:e,updateMarker:a}=r.useContext(w),t=Object.values(d).filter(c=>c.type===M.MARKER),[s,i]=r.useState(null);r.useEffect(()=>{const c=t.find(u=>u.name===(e==null?void 0:e.type));i(c)},[e]);const l=c=>i(c);return e?n.jsx(V,{initialValues:{name:(e==null?void 0:e.name)||"",latitude:(e==null?void 0:e.latitude)||"",longitude:(e==null?void 0:e.longitude)||"",description:(e==null?void 0:e.description)||"",type:(e==null?void 0:e.type)||"",reserve_meters:(e==null?void 0:e.reserve_meters)||1,nap_buffer:(e==null?void 0:e.nap_buffer)||1,nap_thread:(e==null?void 0:e.nap_thread)||1,nap_ports:(e==null?void 0:e.nap_ports)||1},validationSchema:$({name:_().required("Ingrese el nombre del marcador"),latitude:g().required("Ingrese la latitud"),longitude:g().required("Ingrese la longitud"),reserve_meters:g().required("Ingrese los metros de reserva"),nap_buffer:g().required("Ingrese el buffer"),nap_thread:g().required("Ingrese el puerto"),nap_ports:g().required("Ingrese el numero de puertos")}),onSubmit:async c=>{await a(e.id,c)},children:({handleSubmit:c,values:u,handleChange:o,isSubmitting:x})=>n.jsxs("form",{onSubmit:c,className:" flex flex-col ",children:[n.jsx(y,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsxs("div",{className:" flex gap-3 ",children:[n.jsx(y,{name:"latitude",label:"Latitud:",placeholder:"Latitud"}),n.jsx(y,{name:"longitude",label:"Longitud:",placeholder:"Longitud"})]}),n.jsx(y,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{children:[n.jsxs("label",{className:" flex items-center gap-1 ",children:[n.jsx(N,{text:"Tipo de Marcador:"}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 ",children:s==null?void 0:s.name})]}),n.jsx("div",{className:" flex justify-evenly ",children:n.jsx(Z,{selected:s,onSelect:h=>{l(h),o({target:{name:"type",value:h.name}})}})})]}),(s==null?void 0:s.name)===d.RESERVA.name&&n.jsx(y,{name:"reserve_meters",type:"number",label:"METROS:",placeholder:"Metros de reserva"}),((s==null?void 0:s.name)===d.NAP1.name||(s==null?void 0:s.name)===d.NAP2.name)&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:" flex gap-4 ",children:[n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(N,{text:"Buffer:"}),n.jsx(q,{onChange:(h,p)=>o({target:{name:"nap_buffer",value:p}}),value:u.nap_buffer}),n.jsx(F,{name:"nap_buffer"})]}),n.jsxs("div",{className:" flex flex-col gap-2 ",children:[n.jsx(N,{text:"Hilo:"}),n.jsx(q,{onChange:(h,p)=>o({target:{name:"nap_thread",value:p}}),value:u.nap_thread}),n.jsx(F,{name:"nap_thread"})]})]}),n.jsxs("div",{children:[n.jsx(N,{text:"Numero de Puertos:"}),n.jsx(S,{value:u.nap_ports})]})]}),n.jsx("button",{type:"submit",className:m(" bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":x}),disabled:x,children:x?n.jsx(b,{icon:E,spin:!0}):"Guardar"})]})}):null}function y({label:e,classInput:a="",...t}){return n.jsxs("div",{className:" flex-1 flex flex-col ",children:[n.jsx(N,{text:e}),n.jsx(B,{name:t.name,className:m(" border rounded p-2 ",a),...t}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(F,{name:t.name})})]})}function N({text:e,className:a}){return n.jsx("label",{className:m(" font-bold text-sm uppercase pl-1 mb-1 ",a),children:e})}function se({selected:e,onSelect:a}){const t=Object.values(d).filter(s=>s.type===M.FIBER);return e||(e=t[0]),n.jsx(n.Fragment,{children:t.map(s=>n.jsxs("button",{type:"button",className:m(" flex flex-col justify-center items-center w-[52px] aspect-square bg-transparent transition-all duration-300 py-1 px-1.5 rounded-lg hover:bg-black/5 ",{" bg-black/10 hover:bg-black/10 ":s.name===e.name}),onClick:()=>a(s),children:[n.jsx(b,{style:{color:s.color},className:"text-lg",icon:s.icon}),n.jsx("span",{className:" text-xs leading-3 ",children:s.name})]},s.name))})}function te({fiberType:e,value:a,onChange:t}){const[s,i]=r.useState(null),l=c=>{t&&t(c)};return r.useEffect(()=>{e&&(e===d.DROP.name&&i([1,2,4,6,8,12]),e===d.MINI_ADSS.name&&i([6,8,12,24,48]),e===d.ADSS.name&&i([12,24,48,72,96]))},[e]),r.useEffect(()=>{s&&(s.includes(a)||l(s[0]))},[s]),e?n.jsx("div",{className:" flex justify-center gap-1 ",children:s==null?void 0:s.map(c=>n.jsx(ae,{label:c,selected:a,onClick:()=>l(c)},c))}):null}function ae({label:e,selected:a,...t}){const s=a==e;return n.jsx("button",{type:"button",className:m(" w-10 aspect-square bg-transparent transition-all duration-300 p-1.5 rounded-lg hover:scale-110 hover:bg-black/5 ",{" bg-black/10 hover:bg-black/10 ":s}),...t,children:n.jsx("span",{className:" font-normal ",children:e})})}function re(){const e=r.useRef(null),{isFiberFormOpen:a,closeFiberForm:t}=r.useContext(k);return r.useEffect(()=>{const s=i=>i.key==="Escape"&&t();return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.current&&(e.current.onclick=s=>{s.target===e.current&&t()}),n.jsx("div",{className:m(" absolute inset-0 flex justify-center items-center bg-black/10 backdrop-blur-sm ",{" hidden ":!a}),ref:e,children:n.jsxs("div",{className:" flex flex-col w-full max-w-[500px] p-5 bg-white rounded-lg shadow-lg ",children:[n.jsx("div",{className:" flex justify-end ",children:n.jsx("button",{onClick:t,type:"button",className:" flex justify-center items-center w-10 aspect-square rounded-full bg-black/10 transition duration-300 hover:rotate-90 ",children:n.jsx(b,{icon:L})})}),n.jsx("h4",{className:" uppercase text-center text-xl font-bold ",children:"Editar Fibra"}),n.jsx(le,{})]})})}function le(){const{fiberSelected:e,updateFiber:a,deleteFiber:t,isLoading:s}=r.useContext(k),i=Object.values(d).filter(o=>o.type===M.FIBER),[l,c]=r.useState(null);r.useEffect(()=>{const o=i.find(x=>x.name===(e==null?void 0:e.type));c(o)},[e]);const u=o=>c(o);return e?n.jsx(V,{initialValues:{name:(e==null?void 0:e.name)||"",type:(e==null?void 0:e.type)||"",threads:(e==null?void 0:e.threads)||"",serie:(e==null?void 0:e.serie)||"",description:(e==null?void 0:e.description)||""},validationSchema:$({name:_().required("Ingrese el nombre del marcador"),type:_().required("Seleccione el tipo de fibra"),threads:g().required("Seleccione el numero de hilos")}),onSubmit:async o=>{await a(e.id,o)},children:({handleSubmit:o,values:x,handleChange:h,isSubmitting:p})=>n.jsxs("form",{onSubmit:o,className:" flex flex-col ",children:[n.jsx(O,{name:"name",label:"Nombre:",placeholder:"Nombre del marcador"}),n.jsx(O,{name:"serie",label:"Serie:",placeholder:"Serie del Cable"}),n.jsx(O,{name:"description",label:"Descripcion:",placeholder:"Descripcion del marcador",as:"textarea",classInput:" resizex-none min-h-16 "}),n.jsxs("div",{className:" flex gap-3 w-full h-full ",children:[n.jsxs("div",{className:" min-w-44 flex flex-col justify-between ",children:[n.jsxs("label",{className:" flex justify-center items-center gap-1  ",children:[n.jsx(I,{text:"Tipo de Fibra:",className:" pl-1 "}),n.jsx("span",{className:" font-normal uppercase text-sm pb-1 mr-auto  ",children:l==null?void 0:l.name})]}),n.jsx("div",{className:" flex justify-center gap-1 ",children:n.jsx(se,{selected:l,onSelect:j=>{u(j),h({target:{name:"type",value:j.name}})}})})]}),n.jsxs("div",{className:" flex-1 flex flex-col justify-between",children:[n.jsx(I,{className:" flex justify-center items-center ",text:"Numero de Hilos:"}),n.jsx(te,{fiberType:l==null?void 0:l.name,value:x.threads,onChange:j=>h({target:{name:"threads",value:j}})})]})]}),n.jsxs("div",{className:" flex mt-4 ",children:[n.jsx("button",{type:"submit",className:m(" flex-1 bg-blue-500 text-white rounded p-3 mt-2 uppercase font-bold hover:bg-blue-600 ",{" opacity-50 cursor-not-allowed ":p||s}),disabled:p||s,children:p?n.jsx(b,{icon:E,spin:!0}):"Guardar"}),n.jsx("button",{type:"button",className:m(" flex-1 bg-red-500 text-white rounded p-3 mt-2 ml-2 uppercase font-bold hover:bg-red-600 ",{" opacity-50 cursor-not-allowed ":s||p}),disabled:s||p,onClick:()=>t(e.id),children:s?n.jsx(b,{icon:E,spin:!0}):"Eliminar"})]})]})}):null}function O({label:e,classInput:a="",classWrap:t,...s}){return n.jsxs("div",{className:m(" flex-1 flex flex-col  ",t),children:[n.jsx(I,{text:e}),n.jsx(B,{name:s.name,className:m(" border rounded p-2 ",a),...s}),n.jsx("div",{className:" w-full h-6 text-red-500 text-sm ",children:n.jsx(F,{name:s.name})})]})}function I({text:e,className:a}){return n.jsx("label",{className:m(" font-bold text-sm uppercase pl-1 mb-1 ",a),children:e})}function ie({mapRef:e}){const{toolSelected:a}=r.useContext(v),t=r.useRef(!0),{markers:s}=r.useContext(w),{fibers:i}=r.useContext(k);return r.useEffect(()=>{e.current&&(document.querySelector(".leaflet-container").style.cursor=a.cursor)},[a]),r.useEffect(()=>{if(!e.current)return;const l=e.current;s===null||i===null||!Array.isArray(s)||!Array.isArray(i)||s.length===0&&i.length===0||t.current!==!1&&(t.current===!0&&(t.current=!1),l.fitBounds([...s.map(c=>[c.latitude,c.longitude]),...i.map(c=>c.fiber_markers.map(u=>[u.latitude,u.longitude]))]))},[s,i]),{mapRef:e}}function me(){const{isSearching:e,searchLocation:a}=r.useContext(v),{isOpenHeaderOptions:t}=r.useContext(G),{isMarkerFormOpen:s}=r.useContext(w),{isFiberFormOpen:i}=r.useContext(k);return n.jsxs("div",{className:" relative flex w-full h-full ",children:[n.jsx(ee,{}),n.jsx(re,{}),n.jsx("div",{className:m(" relative flex w-full h-full p-7",{" -z-10 ":t||s||i}),children:n.jsxs("div",{className:" flex flex-col w-full h-full rounded-2xl shadow-xl overflow-hidden bg-white ",children:[n.jsxs("div",{className:" flex items-center py-1 px-4 ",children:[Object.values(d).map(l=>n.jsx(oe,{tool:l},l.name)),n.jsxs("div",{className:m(" flex items-center border w-full max-w-96 py-2 px-2 ml-auto rounded ",{" bg-black/5 ":e," bg-white ":!e}),children:[n.jsx("input",{onKeyDown:l=>{l.key==="Enter"&&a(l.target.value)&&(l.target.value="")},className:" w-full ",type:"text",placeholder:"Buscar lugar",disabled:e}),e&&n.jsx(b,{icon:E,spin:!0}),!e&&n.jsx(b,{icon:J})]})]}),n.jsx(ce,{})]})})]})}const ce=()=>{const{mapRef:e}=r.useContext(v);return ie({mapRef:e}),n.jsxs(U,{ref:e,className:m(" flex w-full h-full cursor-pointer "),center:[-2.3093213892775175,-78.12541130262117],zoom:3,children:[n.jsx(W,{}),n.jsx(X,{}),n.jsx(Y,{})]})};function oe({tool:e}){const{toolSelected:a,selectTool:t}=r.useContext(v),s=a.name===e.name,i=typeof e.icon=="string";return n.jsxs("button",{onClick:()=>t(e),className:m(" flex flex-col justify-between items-center py-1 px-3 h-full rounded transition-all hover:bg-black/5 hover:scale-110 ",{" opacity-80  ":!s," bg-black/5 hover:scale-100 ":s}),style:{color:e.color},children:[i?n.jsx("img",{className:" h-full max-h-6 aspect-square object-contain",src:e.icon,alt:e.name}):n.jsx(b,{className:"text-lg",icon:e.icon}),n.jsx("p",{className:" text-black text-[10.5px] ",children:e.name})]})}export{me as default};
